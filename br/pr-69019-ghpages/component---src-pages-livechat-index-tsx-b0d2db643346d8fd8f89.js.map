{"version":3,"file":"component---src-pages-livechat-index-tsx-b0d2db643346d8fd8f89.js","mappings":"sKAGaA,EAAc,WACvB,OAA0DC,EAAAA,EAAAA,WAAS,GAA5DC,EAAP,KAAgCC,EAAhC,KACMC,GAAUC,EAAAA,EAAAA,OAAeC,OAAOF,QAAW,GACjD,GAAoCH,EAAAA,EAAAA,WAAS,GAAtCM,EAAP,KAAqBC,EAArB,KAEMC,EADa,IAAIC,iBAAiBL,EAAAA,EAAAA,OAAeC,OAAOK,SAASC,QAAW,IAC7CC,IAAI,oBA0HzC,OA7GAC,EAAAA,EAAAA,YAAU,WACN,IAAIC,EAAkB,KAClBC,EAAiB,KACrB,IAAIX,EAAAA,EAAAA,MAAa,CACb,IAAMY,GAASC,EAAAA,EAAAA,MASfH,EAAkBI,aALP,WACH,IAAMC,GAAqBC,EAAAA,EAAAA,IAAqBJ,GAChDT,IAAcY,KAGqB,KAG3CJ,EAAiBM,YAAW,WA3BT,IAACC,EAClBC,EADkBD,EA4BG,WACfjB,OAAOmB,eAAeC,GAAG,SAAS,WAC9BvB,GAAuB,GACkB,UAArCM,MAAAA,OAAAA,EAAAA,EAAmBkB,gBACnBrB,OAAOF,OAAOwB,wBA/B5BJ,EAAkBK,SAASC,cAAc,WAC/BC,UAAhBP,kxBAKAK,SAASG,KAAKC,YAAYT,GACtBD,GAAUA,MA4BP,KAEP,OAAO,WACHW,cAAcnB,GACdoB,aAAanB,MAElB,KAEHF,EAAAA,EAAAA,YAAU,WACN,IAAIT,EAAAA,EAAAA,MAAa,CACb,IAAMY,GAASC,EAAAA,EAAAA,MACXhB,GACAI,OAAOmB,eAAeC,GAAG,SAAS,WAAO,IAAD,EAEpCpB,OAAOF,OAAOwB,mBACdtB,OAAOF,OAAOgC,mBAEd,IAAMC,GAAWC,EAAAA,EAAAA,IAAWrB,GACtBG,GAAqBC,EAAAA,EAAAA,IAAqBJ,GAC1CsB,EAAa,IAAI7B,gBAAgBJ,OAAOK,SAASC,QAEvD,EAAiDyB,GAAY,GAArDG,EAAR,EAAQA,WAAYC,EAApB,EAAoBA,WAAYC,EAAhC,EAAgCA,aAEhC,EAQItB,GAAsB,GAPtBuB,EADJ,EACIA,QACAC,EAFJ,EAEIA,MACAC,EAHJ,EAGIA,0BACAC,EAJJ,EAIIA,SACAC,EALJ,EAKIA,UACAC,EANJ,EAMIA,WACAC,EAPJ,EAOIA,UAKEC,EAAoB,CACtB3C,aAAcA,EACdoC,QAASA,MAAAA,EAAAA,EAAW,GACpBE,0BAA2BA,MAAAA,EAAAA,EAA6B,GACxDC,SAAUA,MAAAA,EAAAA,EAAY,GACtBC,UAAWA,MAAAA,EAAAA,EAAa,GACxBH,MAAOA,MAAAA,EAAAA,EAAS,GAChBO,SAAQ,UAAEZ,EAAW1B,IAAI,mBAAjB,QAAgC,GACxC2B,WAAYA,MAAAA,EAAAA,EAAc,GAC1BC,WAAYA,MAAAA,EAAAA,EAAc,GAC1BC,aAAcA,MAAAA,EAAAA,EAAgB,IAGlCpC,OAAOmB,eAAe2B,KAAK,wBAAyBF,GAEhD3C,GACIqC,GACAtC,OAAOmB,eAAe2B,KAAK,qBAAsBR,GAEjDI,GAAcC,GACd3C,OAAOmB,eAAe2B,KAClB,oBACGJ,EAFP,IAEqBC,IAKzB3C,OAAOF,OAAOiD,cAAgB,WAC1B/C,OAAOmB,eAAe2B,KAAK,qBAAsB,KACjD9C,OAAOmB,eAAe2B,KAAK,oBAAqB,MAIxD,IAAM3C,EAAoB8B,EAAW1B,IAAI,oBACA,UAArCJ,MAAAA,OAAAA,EAAAA,EAAmBkB,gBACnBrB,OAAOF,OAAOwB,mBAIlBtB,OAAOmB,eAAeC,GAAG,aAAa,SAAC4B,GAC/BA,EAAMC,UACNjD,OAAOF,OAAOwB,4BAMnC,CAACrB,EAAcL,IAEX,CAACA,EAAyBE,K,8GCtH/BoD,GAAkBC,EAAAA,EAAAA,SAAOC,EAAAA,IAAVC,WAAA,qEAAGF,CAAH,4DAMfG,EAAsBH,EAAAA,QAAAA,IAAAA,WAAH,yEAAGA,CAAH,0IAIV,qBAAGI,QAAyB,OAAS,WA0CpD,WAAeC,EAAAA,EAAAA,KAAf,EAnCqB,WACjB,OAA0C9D,EAAAA,EAAAA,KAAnCE,EAAP,KAAgCE,EAAhC,KACA,GAA8BH,EAAAA,EAAAA,WAAS,GAAhC4D,EAAP,KAAgBE,EAAhB,KAkBA,OAhBAjD,EAAAA,EAAAA,YAAU,WAGN,IAAIE,EAAiB,KAQrB,OAPId,IACAc,EAAiBM,YAAW,WACxBlB,EAAOwB,mBACPmC,GAAW,KACZ,MAGA,WACH5B,aAAanB,MAElB,CAACd,IAGA8D,EAAAA,QAAAA,cAACC,EAAAA,EAAD,CAAQC,KAAK,SAASC,WAAY,KAC9BH,EAAAA,QAAAA,cAACI,EAAAA,GAAD,CACIC,OAAOC,EAAAA,EAAAA,IAAS,aAChBC,aAAaD,EAAAA,EAAAA,IAAS,iDACtBE,UAAQ,IAEZR,EAAAA,QAAAA,cAACR,EAAD,KAAkBK,GAAWG,EAAAA,QAAAA,cAACS,EAAAA,EAAD,OAC7BT,EAAAA,QAAAA,cAACU,EAAAA,GAAD,KACIV,EAAAA,QAAAA,cAACJ,EAAD,CAAqBC,QAASA","sources":["webpack://deriv-com/./src/components/hooks/use-livechat.tsx","webpack://deriv-com/./src/pages/livechat/index.tsx"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { getClientInformation, getDomain, getUTMData, isBrowser } from 'common/utility'\n\nexport const useLivechat = () => {\n    const [is_livechat_interactive, setLiveChatInteractive] = useState(false)\n    const LC_API = (isBrowser() && window.LC_API) || {}\n    const [is_logged_in, setLoggedIn] = useState(false)\n    const url_params = new URLSearchParams((isBrowser() && window.location.search) || '')\n    const is_livechat_query = url_params.get('is_livechat_open')\n\n    const loadLiveChatScript = (callback) => {\n        const livechat_script = document.createElement('script')\n        livechat_script.innerHTML = `\n            window.__lc = window.__lc || {};\n            window.__lc.license = 12049137;\n            ;(function(n,t,c){function i(n){return e._h?e._h.apply(null,n):e._q.push(n)}var e={_q:[],_h:null,_v:\"2.0\",on:function(){i([\"on\",c.call(arguments)])},once:function(){i([\"once\",c.call(arguments)])},off:function(){i([\"off\",c.call(arguments)])},get:function(){if(!e._h)throw new Error(\"[LiveChatWidget] You canâ€™t use getters before load.\");return i([\"get\",c.call(arguments)])},call:function(){i([\"call\",c.call(arguments)])},init:function(){var n=t.createElement(\"script\");n.async=!0,n.type=\"text/javascript\",n.src=\"https://cdn.livechatinc.com/tracking.js\",t.head.appendChild(n)}};!n.__lc.asyncInit&&e.init(),n.LiveChatWidget=n.LiveChatWidget||e}(window,document,[].slice))\n        `\n        document.body.appendChild(livechat_script)\n        if (callback) callback()\n    }\n\n    useEffect(() => {\n        let cookie_interval = null\n        let script_timeout = null\n        if (isBrowser()) {\n            const domain = getDomain()\n\n            /* this function runs every second to determine logged in status*/\n            const checkCookie = (() => {\n                return function () {\n                    const client_information = getClientInformation(domain)\n                    setLoggedIn(!!client_information)\n                }\n            })()\n            cookie_interval = setInterval(checkCookie, 1000)\n\n            // The purpose is to load the script after everything is load but not async or defer. Therefore, it will be ignored in the rendering timeline\n            script_timeout = setTimeout(() => {\n                loadLiveChatScript(() => {\n                    window.LiveChatWidget.on('ready', () => {\n                        setLiveChatInteractive(true)\n                        if (is_livechat_query?.toLowerCase() === 'true') {\n                            window.LC_API.open_chat_window()\n                        }\n                    })\n                })\n            }, 2000)\n        }\n        return () => {\n            clearInterval(cookie_interval)\n            clearTimeout(script_timeout)\n        }\n    }, [])\n\n    useEffect(() => {\n        if (isBrowser()) {\n            const domain = getDomain()\n            if (is_livechat_interactive) {\n                window.LiveChatWidget.on('ready', () => {\n                    // we open and close the window to trigger the widget to listen for new events\n                    window.LC_API.open_chat_window()\n                    window.LC_API.hide_chat_window()\n\n                    const utm_data = getUTMData(domain)\n                    const client_information = getClientInformation(domain)\n                    const url_params = new URLSearchParams(window.location.search)\n\n                    const { utm_source, utm_medium, utm_campaign } = utm_data || {}\n\n                    const {\n                        loginid,\n                        email,\n                        landing_company_shortcode,\n                        currency,\n                        residence,\n                        first_name,\n                        last_name,\n                    } = client_information || {}\n\n                    /* the session variables are sent to CS team dashboard to notify user has logged in\n                    and also acts as custom variables to trigger targeted engagement */\n                    const session_variables = {\n                        is_logged_in: is_logged_in,\n                        loginid: loginid ?? '',\n                        landing_company_shortcode: landing_company_shortcode ?? '',\n                        currency: currency ?? '',\n                        residence: residence ?? '',\n                        email: email ?? '',\n                        platform: url_params.get('platform') ?? '',\n                        utm_source: utm_source ?? '',\n                        utm_medium: utm_medium ?? '',\n                        utm_campaign: utm_campaign ?? '',\n                    }\n\n                    window.LiveChatWidget.call('set_session_variables', session_variables)\n\n                    if (is_logged_in) {\n                        if (email) {\n                            window.LiveChatWidget.call('set_customer_email', email)\n                        }\n                        if (first_name && last_name) {\n                            window.LiveChatWidget.call(\n                                'set_customer_name',\n                                `${first_name} ${last_name}`,\n                            )\n                        }\n                    } else {\n                        // clear name and email fields after chat has ended\n                        window.LC_API.on_chat_ended = () => {\n                            window.LiveChatWidget.call('set_customer_email', ' ')\n                            window.LiveChatWidget.call('set_customer_name', ' ')\n                        }\n                    }\n\n                    const is_livechat_query = url_params.get('is_livechat_open')\n                    if (is_livechat_query?.toLowerCase() === 'true') {\n                        window.LC_API.open_chat_window()\n                    }\n\n                    // open chat widget when there is an incoming greeting/announcement\n                    window.LiveChatWidget.on('new_event', (event) => {\n                        if (event.greeting) {\n                            window.LC_API.open_chat_window()\n                        }\n                    })\n                })\n            }\n        }\n    }, [is_logged_in, is_livechat_interactive])\n\n    return [is_livechat_interactive, LC_API]\n}\n","import React, { useEffect, useState } from 'react'\nimport styled from 'styled-components'\nimport Layout from 'components/layout/layout'\nimport InitialLoader from 'components/elements/dot-loader'\nimport { localize, WithIntl } from 'components/localization'\nimport { SEO, Container, Mobile } from 'components/containers'\nimport { useLivechat } from 'components/hooks/use-livechat'\n\ntype CoverMinimizeButtonTypes = {\n    loading: boolean\n}\n\nconst StyledContainer = styled(Container)`\n    text-align: center;\n    height: 100vh;\n    justify-content: center;\n`\n\nconst CoverMinimizeButton = styled.div<CoverMinimizeButtonTypes>`\n    width: 70px;\n    height: 50px;\n    background-color: rgb(255 255 255);\n    display: ${({ loading }) => (loading ? 'none' : 'block')};\n    position: absolute;\n    top: -85px;\n    right: 0;\n    z-index: 999999999999999999;\n`\n\nconst LiveChatPage = () => {\n    const [is_livechat_interactive, LC_API] = useLivechat()\n    const [loading, setLoading] = useState(true)\n\n    useEffect(() => {\n        // The reason for this timeout is to help delay before calling LC_API.open_chat_window() function,\n        // so that it only call the function if Live Chat is fully loaded.\n        let script_timeout = null\n        if (is_livechat_interactive) {\n            script_timeout = setTimeout(() => {\n                LC_API.open_chat_window()\n                setLoading(false)\n            }, 1000)\n        }\n\n        return () => {\n            clearTimeout(script_timeout)\n        }\n    }, [is_livechat_interactive])\n\n    return (\n        <Layout type=\"static\" margin_top={'0'}>\n            <SEO\n                title={localize('Live Chat')}\n                description={localize('This page automatically open Live Chat window')}\n                no_index\n            />\n            <StyledContainer>{loading && <InitialLoader />}</StyledContainer>\n            <Mobile>\n                <CoverMinimizeButton loading={loading} />\n            </Mobile>\n        </Layout>\n    )\n}\n\nexport default WithIntl()(LiveChatPage)\n"],"names":["useLivechat","useState","is_livechat_interactive","setLiveChatInteractive","LC_API","isBrowser","window","is_logged_in","setLoggedIn","is_livechat_query","URLSearchParams","location","search","get","useEffect","cookie_interval","script_timeout","domain","getDomain","setInterval","client_information","getClientInformation","setTimeout","callback","livechat_script","LiveChatWidget","on","toLowerCase","open_chat_window","document","createElement","innerHTML","body","appendChild","clearInterval","clearTimeout","hide_chat_window","utm_data","getUTMData","url_params","utm_source","utm_medium","utm_campaign","loginid","email","landing_company_shortcode","currency","residence","first_name","last_name","session_variables","platform","call","on_chat_ended","event","greeting","StyledContainer","styled","Container","withConfig","CoverMinimizeButton","loading","WithIntl","setLoading","React","Layout","type","margin_top","SEO","title","localize","description","no_index","InitialLoader","Mobile"],"sourceRoot":""}